# è®¾è®¡æ¨¡å¼æµ…æ(äºŒ) Â·è§‚å¯Ÿè€…æ¨¡å¼

## æ—¥å¸¸å¨é€¼å¨

javaè®¾è®¡æ¨¡å¼æµ…æï¼Œå¦‚æœè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ä¸€é”®ä¸‰è¿ï¼Œè°¢è°¢å„ä½è§‚ä¼—è€çˆ·ğŸ˜ğŸ˜



---

## æ¡ˆä¾‹ä»‹ç»

å‡è®¾å­˜åœ¨ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼š

> ä½ æœ‰ä¸€ä¸ªç›‘æµ‹ç©ºæ°”æ¹¿åº¦å’Œæ¸©åº¦çš„ä»ªå™¨ï¼Œåœ¨è¯¥ä»ªå™¨è·å–åˆ°æ•°å€¼ä¹‹åï¼Œä½ éœ€è¦è·å–åˆ°ä¸€äº›æ•°å€¼ï¼Œç„¶ååˆ†åˆ«æ˜¾ç¤ºåœ¨ä¸€äº›æ˜¾ç¤ºè®¾å¤‡ï¼ˆæ‰‹æœºï¼Œå¹³æ¿ï¼Œæ‰‹ç¯ å·´æ‹‰å·´æ‹‰å·´æ‹‰ æ— æ‰€è°“äº†ï¼‰ä¸Šã€‚

![ç”¨æˆ·å…³ç³»](./01.jpg)

> ç„¶åå‘¢ï¼Œç¡¬ä»¶è®¾å¤‡çš„å¼€å‘äººå‘˜å‘Šè¯‰ä½ ï¼Œè¿™ä¸ª`data`å¯¹è±¡å‘¢ç±»å›¾å¦‚ä¸‹ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå˜é‡ï¼Œæ¸©åº¦å’Œé€‚åº¦ï¼Œç„¶åå‘¢è¿˜æœ‰ä¸€äº›å¯¹åº”çš„`get/set`æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•`dataChanged`,è¯´æ˜¯åœ¨è¿™äº›æ•°å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œè°ƒç”¨ã€‚

![image-20240202143344089](./02.png)

é‚£ä¹ˆ æˆ‘ä»¬æ ¹æ®ç¡¬ä»¶è®¾å¤‡å¼€å‘äººå‘˜çš„æç¤º,åœ¨`dataChanged()`æ–¹æ³•ä¸­å®Œæˆäº†ä»¥ä¸‹çš„ä»£ç 

```java
 public void dataChanged() {
     //é»˜è®¤Dataåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡setæ–¹æ³•å°†æ¸©åº¦ï¼Œæ¹¿åº¦ç­‰è®¾ç½®å¥½äº†
        //do something when data changed
        double temperature1 = getTemperature();
        double humidity1 = getHumidity();
        
        Phone.update(temperature1,humidity1);
        Pad.update(temperature1,humidity1);
     	Monitor.update(temperature1,humidity1);
    }
```

ä½†æ˜¯å¯¹äºæ‰€æœ‰çš„è®¾å¤‡æ¥è¯´éƒ½å­˜åœ¨updateæ–¹æ³•ï¼Œæœ‰ç‚¹å…¬å…±çš„æ„æ€åœ¨é‡Œé¢ï¼Œè€Œä¸”åœ¨åé¢å¦‚æœå¢åŠ è®¾å¤‡æˆ–è€…åˆ é™¤è®¾å¤‡æ—¶ï¼Œä¼šè¿›è¡Œæ¯”è¾ƒå¤§é‡çš„æ”¹åŠ¨ï¼Œä¸æ˜¯ä¸€ä¸ªè¾ƒå¥½çš„è®¾è®¡æ–¹æ¡ˆã€‚

æ—¢ç„¶æ˜¯æµ…æè§‚å¯Ÿè€…æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬å°è¯•ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥è¿›è¡Œä¸Šè¿°æ–¹æ¡ˆçš„ä¼˜åŒ–

## è§‚å¯Ÿè€…æ¨¡å¼

åœ¨äº†è§£è§‚å¯Ÿè€…æ¨¡å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å…³äºæŠ¥çº¸çš„è®¢é˜…ï¼Œå°±è®¢é˜…æŠ¥çº¸è¿™ä¸€è¡Œä¸ºæ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š

> 1-å‘æŸå®¶æŠ¥ç¤¾è®¢é˜…æŠ¥çº¸ï¼Œåªè¦ä»–ä»¬æœ‰æ–°æŠ¥çº¸å‡ºç‰ˆï¼Œå°±ä¼šç»™ä½ é€æ¥ã€‚åªè¦ä½ æ˜¯ä»–ä»¬çš„è®¢æˆ·ï¼Œä½ å°±ä¼šä¸€ç›´æ”¶åˆ°æ–°æŠ¥çº¸ã€‚
> 2-å½“ä½ ä¸æƒ³å†çœ‹æŠ¥çº¸çš„æ—¶å€™ï¼Œå–æ¶ˆè®¢é˜…ï¼Œä»–ä»¬å°±ä¸ä¼šå†é€æ–°æŠ¥çº¸æ¥ã€‚
> 3-åªè¦æŠ¥ç¤¾è¿˜åœ¨è¿è¥ï¼Œå°±ä¼šä¸€ç›´æœ‰äºº(æˆ–å•ä½)å‘ä»–ä»¬è®¢é˜…æŠ¥çº¸æˆ–å–æ¶ˆè®¢é˜…æŠ¥çº¸ã€‚

è€Œè§‚å¯Ÿè€…æ¨¡å¼ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ**è§‚å¯Ÿè€…æ¨¡å¼=å‡ºç‰ˆç¤¾+è®¢é˜…è€…**

å¦‚æœä½ äº†è§£æŠ¥çº¸çš„è®¢é˜…æ˜¯æ€ä¹ˆå›äº‹ï¼Œå…¶å®å°±çŸ¥é“è§‚å¯Ÿè€…æ¨¡å¼æ˜¯æ€ä¹ˆå›äº‹ï¼Œåªæ˜¯åç§°ä¸å¤ªä¸€æ ·:å‡ºç‰ˆè€…æ”¹ç§°ä¸ºâ€œä¸»é¢˜â€(`Subject`)ï¼Œè®¢é˜…è€…æ”¹ç§°ä¸ºâ€œè§‚å¯Ÿè€…â€(`Observer`)

#### é—®é¢˜è§£å†³

å¯¹äºä¸Šè¿°é—®é¢˜ï¼Œä»ªå™¨æ”¶é›†åˆ°æ•°æ®å¯ä»¥ç±»æ¯”ä¸ºä¸»é¢˜ï¼Œè€Œä¸€äº›å±•ç¤ºè®¾å¤‡å¯ä»¥ç±»æ¯”ä¸ºè§‚å¯Ÿè€…ï¼Œåªè¦ä»ªå™¨äº§ç”Ÿçš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œè®¾å¤‡ä¸Šçš„æ•°æ®ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œé™¤éè¯¥è®¾å¤‡æ²¡æœ‰è®¢é˜…è¯¥ä¸»é¢˜ï¼Œè€Œè§‚å¯Ÿè€…å¯ä»¥è®¢é˜…ä¸»é¢˜ï¼Œä¹Ÿå¯ä»¥å–æ¶ˆè®¢é˜…ã€‚

é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå¯ä»¥è®¾è®¡ä¸€ä¸ªä¸»é¢˜çš„æ¥å£

```java
public interface Subject {

    //è®¢é˜…
    public void registerObv(Observer obv);

    //é€€è®¢
    public void removeObv(Observer obv);

    //é€šçŸ¥
    public void notifyAllObv();
    
}
```

ç„¶åæˆ‘ä»¬çš„æ•°æ®å®ç°è¿™ä¸ªä¸»é¢˜æ¥å£

```java
public class Data implements Subject {
    private double temperature;//æ¸©åº¦
    private double humidity;//æ¹¿åº¦

    private List<Observer> ObvList;

    public Data() {
        ObvList = new ArrayList<>();
    }

    public double getTemperature() {
        return temperature;
    }


    public double getHumidity() {
        return humidity;
    }

    public void setData(double temperature, double humidity) {
        this.temperature = temperature;
        this.humidity = humidity;
        dataChanged();
    }


    public void dataChanged() {
        //do something when data changed
        notifyAllObv();
    }


    @Override
    public void registerObv(Observer obv) {
        ObvList.add(obv);
    }

    @Override
    public void removeObv(Observer obv) {
        ObvList.remove(obv);
    }

    @Override
    public void notifyAllObv() {
        for (Observer obv : ObvList) {
            obv.update(temperature, humidity);
        }
    }
}
```

å¯¹äºè§‚å¯Ÿè€…ä»¬ï¼Œæˆ‘ä»¬åŒæ ·è®¾ç½®ä¸€ä¸ªè§‚å¯Ÿè€…ï¼ˆ`Observer`ï¼‰çš„æ¥å£å’Œä¸€ä¸ªæ˜¾ç¤ºï¼ˆ`display`ï¼‰çš„æ¥å£

```java
public interface Observer {
    public void update(double temp, double humidity);
}
```

```java
public interface Display {
    public void display();
}
```

åˆ›å»ºä¸€ä¸ªæ‰‹æœºæ˜¾ç¤ºï¼Œæ˜¾ç¤ºæ¸©åº¦å’Œæ¹¿åº¦

```java
public class PhoneDisplay implements Observer, Display {
    private double temp;
    private double humidity;
    private Subject project;

    public PhoneDisplay(Subject project) {
        this.project = project;
        project.registerObv(this);
    }

    @Override
    public void display() {
        System.out.println("æ¸©åº¦ï¼š" + temp + "æ¹¿åº¦ï¼š" + humidity);

    }

    @Override
    public void update(double temp, double humidity) {
        this.temp = temp;
        this.humidity = humidity;
        this.display();
    }
}
```

åˆ›å»ºä¸»ç±»è¿›è¡Œæµ‹è¯•

```java
public class DataMain {
    public static void main(String[] args) {
        Data data = new Data();
        PhoneDisplay phone = new PhoneDisplay(data);
        PadDisplay pad = new PadDisplay(data);

        data.setData(1,2);
        data.setData(2,3);
        //padå–æ¶ˆè®¢é˜…
        data.removeObv(pad);
        data.setData(2,3);
        data.setData(4,3);

    }
}

//è¿è¡Œç»“æœ
æ‰‹æœºæ˜¾ç¤ºã€æ¸©åº¦ï¼š1.0æ¹¿åº¦ï¼š2.0ã€‘
pad æ˜¾ç¤ºï¼šæ¸©åº¦ã€1.0ã€‘
æ‰‹æœºæ˜¾ç¤ºã€æ¸©åº¦ï¼š2.0æ¹¿åº¦ï¼š3.0ã€‘
pad æ˜¾ç¤ºï¼šæ¸©åº¦ã€2.0ã€‘
æ‰‹æœºæ˜¾ç¤ºã€æ¸©åº¦ï¼š2.0æ¹¿åº¦ï¼š3.0ã€‘
æ‰‹æœºæ˜¾ç¤ºã€æ¸©åº¦ï¼š4.0æ¹¿åº¦ï¼š3.0ã€‘

Process finished with exit code 0

```

è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ç§å¯¹äºä¸Šè¿°æ¡ˆä¾‹çš„è§£å†³æ–¹æ¡ˆã€‚

![image-20240202164015727](./03.png)

é™¤äº†è‡ªå®šä¹‰è®¢é˜…è€…ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨java.utilä¸­çš„`Observable`å’Œ`Observer`è¿›è¡Œå®ç°ï¼Œä½†æ˜¯`Observable`æ˜¯ä¸€ä¸ªâ€œç±»â€è€Œéæ¥å£ï¼Œä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªç±»ç»§æ‰¿å®ƒã€‚å¦‚æœæŸç±»æƒ³åŒæ—¶å…·æœ‰`Observable`ç±»å’Œå¦ä¸€ä¸ªè¶…ç±»çš„è¡Œä¸ºï¼Œå°±ä¼šé™·å…¥ä¸¤éš¾ï¼Œæ¯•ç«ŸJavaä¸æ”¯æŒå¤šé‡ç»§æ‰¿è¿™é™åˆ¶Observableçš„å¤ç”¨æ½œåŠ›(è€Œå¢åŠ å¤ç”¨æ½œåŠ›ä¸æ­£æ˜¯æˆ‘ä»¬ä½¿ç”¨æ¨¡å¼æœ€åŸå§‹çš„åŠ¨æœºå—?)ã€‚
å†è€…ï¼Œå› ä¸ºæ²¡æœ‰`Observable`æ¥å£ï¼Œæ‰€ä»¥ä½ æ— æ³•å»ºç«‹è‡ªå·±çš„å®ç°ï¼Œå’ŒJavaå†…ç½®çš„Observer APIæ­é…ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å°†java.utilçš„å®ç°æ¢æˆå¦ä¸€å¥—åšæ³•çš„å®ç°



## æ€»ç»“

è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç‚¹ï¼š

1. é™ä½è€¦åˆæ€§ï¼šè§‚å¯Ÿè€…æ¨¡å¼å°†ä¸»é¢˜ï¼ˆ`Subject`ï¼‰å’Œè§‚å¯Ÿè€…ï¼ˆ`Observer`ï¼‰ä¹‹é—´çš„ä¾èµ–å…³ç³»è§£è€¦ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜ã€‚ä¸»é¢˜ä¸éœ€è¦çŸ¥é“å“ªäº›è§‚å¯Ÿè€…æ­£åœ¨è§‚å¯Ÿå®ƒï¼Œè§‚å¯Ÿè€…ä¹Ÿä¸éœ€è¦çŸ¥é“ä¸»é¢˜çš„ç»†èŠ‚ã€‚
2. æ˜“äºæ‰©å±•ï¼šç”±äºè§‚å¯Ÿè€…æ¨¡å¼æ˜¯æ¾æ•£è€¦åˆçš„ï¼Œå› æ­¤å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ æˆ–åˆ é™¤è§‚å¯Ÿè€…ï¼Œè€Œä¸ä¼šå½±å“ä¸»é¢˜æˆ–å…¶ä»–è§‚å¯Ÿè€…ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ çµæ´»ï¼Œæ˜“äºæ‰©å±•ã€‚
3. å®ç°äº†å¼€æ”¾/å°é—­åŸåˆ™ï¼šè§‚å¯Ÿè€…æ¨¡å¼éµå¾ªå¼€æ”¾/å°é—­åŸåˆ™ï¼Œå³å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œå¯¹äºä¿®æ”¹æ˜¯å°é—­çš„ã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„è§‚å¯Ÿè€…æ¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œè€Œä¸å¿…æ›´æ”¹ç°æœ‰ä»£ç ã€‚
4. å®ç°äº†å¯é‡ç”¨æ€§ï¼šè§‚å¯Ÿè€…æ¨¡å¼å°†ä¸»é¢˜å’Œè§‚å¯Ÿè€…åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæµ‹è¯•å’Œé‡ç”¨ã€‚
5. æé«˜äº†çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šè§‚å¯Ÿè€…æ¨¡å¼ä½¿å¾—ç³»ç»Ÿä¸­çš„å¯¹è±¡ä¹‹é—´çš„é€šä¿¡å˜å¾—æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚å®ƒè¿˜ä½¿ä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚

è§‚å¯Ÿè€…æ¨¡å¼çš„ç¼ºç‚¹ï¼š

1. å†…å­˜æ³„æ¼ï¼šåœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè§‚å¯Ÿè€…éœ€è¦æ³¨å†Œåˆ°ä¸»é¢˜å¯¹è±¡ï¼Œå½“è§‚å¯Ÿè€…ä¸å†éœ€è¦æ—¶ï¼Œéœ€è¦ä»ä¸»é¢˜ä¸­æ³¨é”€ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å› ä¸ºå¦‚æœè§‚å¯Ÿè€…å¯¹è±¡æ²¡æœ‰è¢«æ³¨é”€ï¼Œåˆ™ä¸»é¢˜å¯¹è±¡å°†ä¿ç•™å¯¹å®ƒçš„å¼•ç”¨ï¼Œè¿™å°†é˜²æ­¢è§‚å¯Ÿè€…è¢«åƒåœ¾å›æ”¶ã€‚
2. æ€§èƒ½é—®é¢˜ï¼šè§‚å¯Ÿè€…æ¨¡å¼åœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å½“ä¸»é¢˜å¯¹è±¡æœ‰å¤§é‡è§‚å¯Ÿè€…æ—¶ï¼Œæ¯å½“ä¸»é¢˜çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šè¢«é€šçŸ¥ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚
3. å¹¶å‘é—®é¢˜ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸»é¢˜å¯¹è±¡ï¼Œå¹¶ä¸”ä¸»é¢˜å¯¹è±¡åœ¨å¤„ç†ä¸€ä¸ªè§‚å¯Ÿè€…æ—¶çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ—¶éœ€è¦å°å¿ƒå¤„ç†å¹¶å‘é—®é¢˜ã€‚
4. å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼šè§‚å¯Ÿè€…æ¨¡å¼ä¸­çš„ä¸»é¢˜å¯¹è±¡å’Œè§‚å¯Ÿè€…å¯¹è±¡ä¹‹é—´å¯èƒ½å­˜åœ¨ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ã€‚å¦‚æœè§‚å¯Ÿè€…å¯¹è±¡åœ¨ä¸»é¢˜å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¿…è¦çš„é—®é¢˜ã€‚

---

ä»£ç ç›¸å…³ä»£ç å¯ä»¥å‚è€ƒ **[ä»£ç ä»“åº“ğŸŒ](https://gitee.com/jerrylau213/DesignPatterns)**

**psï¼šæœ¬æ–‡åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„**

---